!function(p,n,h){"use strict";var e="pep",i={initiate:function(){},start:function(){},drag:function(){},stop:function(){},easing:null,rest:function(){},moveTo:!1,callIfNotStarted:["stop","rest"],startThreshold:[0,0],grid:[1,1],debug:!1,activeClass:"pep-active",startClass:"pep-start",easeClass:"pep-ease",multiplier:1,velocityMultiplier:2.5,shouldPreventDefault:!0,allowDragEventPropagation:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!0,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:1e3,shouldEase:!0,droppable:!1,droppableActiveClass:"pep-dpa",overlapFunction:!1,constrainTo:!1,removeMargins:!0,place:!0,deferPlacement:!1,axis:null,forceNonCSS3Movement:!1,elementsWithInteraction:"input",revert:!1,revertAfter:"stop",revertIf:function(){return!0},ignoreRightClick:!0,startPos:{left:null,top:null},useBoundingClientRect:!1};function o(t,s){return this.name=e,this.el=t,this.$el=p(t),this.options=p.extend({},i,s),this.$document=p(this.$el[0].ownerDocument),this.$body=this.$document.find("body"),this.moveTrigger="MSPointerMove pointermove touchmove mousemove",this.startTrigger="MSPointerDown pointerdown touchstart mousedown",this.stopTrigger="MSPointerUp pointerup touchend mouseup",this.startTriggerArray=this.startTrigger.split(" "),this.moveTriggerArray=this.moveTrigger.split(" "),this.stopTriggerArray=this.stopTrigger.split(" "),this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" "),"window"===this.options.constrainTo?this.$container=this.$document:this.options.constrainTo&&"parent"!==this.options.constrainTo?this.$container=p(this.options.constrainTo):this.$container=this.$el.parent(),this.isPointerEventCompatible()&&this.applyMSDefaults(),this.CSSEaseHash=this.getCSSEaseHash(),this.scale=1,this.started=!1,this.disabled=!1,this.autoAxis=!1,this.activeDropRegions=[],this.resetVelocityQueue(),this.init(),this}o.prototype.init=function(){this.options.debug&&this.buildDebugDiv(),this.options.disableSelect&&this.disableSelect(),this.options.place&&!this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.ev={},this.pos={},this.subscribe()},o.prototype.subscribe=function(){var s=this;this.onStartEvent=function(t){s.handleStart(t)},this.$el.on(this.startTrigger,this.onStartEvent),this.onStartEventOnElementsWithInteraction=function(t){t.ignorePropagation=!0},this.$el.on(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction),this.onStopEvents=function(t){s.handleStop(t)},this.$document.on(this.stopEvents,this.onStopEvents),this.onMoveEvents=function(t){s.moveEvent=t},this.$document.on(this.moveTrigger,this.onMoveEvents)},o.prototype.unsubscribe=function(){this.$el.off(this.startTrigger,this.onStartEvent),this.$el.off(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction),this.$document.off(this.stopEvents,this.onStopEvents),this.$document.off(this.moveTrigger,this.onMoveEvents)},o.prototype.handleStart=function(t){var s;t.ignorePropagation||(s=this).isValidMoveEvent(t)&&!this.disabled&&(this.options.ignoreRightClick&&3===t.which||(this.isPointerEventCompatible()&&t.preventManipulation&&t.preventManipulation(),t=this.normalizeEvent(t),this.options.place&&this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.log({type:"event",event:t.type}),this.options.hardwareAccelerate&&!this.hardwareAccelerated&&(this.hardwareAccelerate(),this.hardwareAccelerated=!0),!1!==this.options.initiate.call(this,t,this)&&(clearTimeout(this.restTimeout),this.$el.addClass(this.options.activeClass),this.removeCSSEasing(),this.startX=this.ev.x=t.pep.x,this.startY=this.ev.y=t.pep.y,this.initialPosition=this.initialPosition||this.$el.position(),this.startEvent=this.moveEvent=t,this.active=!0,this.options.shouldPreventDefault&&t.preventDefault(),this.options.allowDragEventPropagation||t.stopPropagation(),function t(){s.active&&(s.handleMove(),s.requestAnimationFrame(t))}(),function t(){s.options.easing&&(s.easing&&s.options.easing.call(s,null,s),s.requestAnimationFrame(t))}())))},o.prototype.handleMove=function(){var t,s,i,e,o;void 0!==this.moveEvent&&(t=this.normalizeEvent(this.moveEvent),e=n.parseInt(t.pep.x/this.options.grid[0])*this.options.grid[0],o=n.parseInt(t.pep.y/this.options.grid[1])*this.options.grid[1],this.addToLIFO({time:t.timeStamp,x:e,y:o}),i=-1<p.inArray(t.type,this.startTriggerArray)?s=0:(s=e-this.ev.x,o-this.ev.y),this.dx=s,this.dy=i,this.ev.x=e,this.ev.y=o,0!==s||0!==i?(e=Math.abs(this.startX-e),o=Math.abs(this.startY-o),!this.started&&(e>this.options.startThreshold[0]||o>this.options.startThreshold[1])&&(this.started=!0,this.$el.addClass(this.options.startClass),this.options.start.call(this,this.startEvent,this)),this.doMoveTo(s,i),this.options.droppable&&this.calculateActiveDropRegions(),!1!==this.options.drag.call(this,t,this)?(this.log({type:"event",event:t.type}),this.log({type:"event-coords",x:this.ev.x,y:this.ev.y}),this.log({type:"velocity"})):this.resetVelocityQueue()):this.log({type:"event",event:"** stopped **"}))},o.prototype.doMoveTo=function(t,s){var i,e,o=this.handleConstraint(t,s);"auto"!==this.options.axis||this.autoAxis||(Math.abs(t)>Math.abs(s)?this.autoAxis="x":Math.abs(t)<Math.abs(s)?this.autoAxis="y":t=s=0),"function"==typeof this.options.moveTo?(i=0<=t?"+="+Math.abs(t/this.scale)*this.options.multiplier:"-="+Math.abs(t/this.scale)*this.options.multiplier,e=0<=s?"+="+Math.abs(s/this.scale)*this.options.multiplier:"-="+Math.abs(s/this.scale)*this.options.multiplier,this.options.constrainTo&&(i=!1!==o.x?o.x:i,e=!1!==o.y?o.y:e),"x"!==this.options.axis&&"x"!==this.autoAxis||(e=o.y),"y"!==this.options.axis&&"y"!==this.autoAxis||(i=o.x),this.options.moveTo.call(this,i,e)):this.shouldUseCSSTranslation()?(t=t/this.scale*this.options.multiplier,s=s/this.scale*this.options.multiplier,this.options.constrainTo&&(t=!1===o.x?t:0,s=!1===o.y?s:0),"x"!==this.options.axis&&"x"!==this.autoAxis||(s=0),"y"!==this.options.axis&&"y"!==this.autoAxis||(t=0),this.moveToUsingTransforms(t,s)):(i=0<=t?"+="+Math.abs(t/this.scale)*this.options.multiplier:"-="+Math.abs(t/this.scale)*this.options.multiplier,e=0<=s?"+="+Math.abs(s/this.scale)*this.options.multiplier:"-="+Math.abs(s/this.scale)*this.options.multiplier,this.options.constrainTo&&(i=!1!==o.x?o.x:i,e=!1!==o.y?o.y:e),"x"!==this.options.axis&&"x"!==this.autoAxis||(e=o.y),"y"!==this.options.axis&&"y"!==this.autoAxis||(i=o.x),this.moveTo(i,e))},o.prototype.handleStop=function(t){this.active&&(this.log({type:"event",event:t.type}),this.active=!1,this.easing=!0,this.$el.removeClass(this.options.startClass).addClass(this.options.easeClass),this.options.droppable&&this.calculateActiveDropRegions(),(this.started||!this.started&&-1<p.inArray("stop",this.options.callIfNotStarted))&&this.options.stop.call(this,t,this),this.options.shouldEase?this.ease(t,this.started):this.removeActiveClass(),this.options.revert&&("stop"===this.options.revertAfter||!this.options.shouldEase)&&this.options.revertIf&&this.options.revertIf.call(this)&&this.revert(),this.started=!1,this.autoAxis&&(this.autoAxis=!1),this.resetVelocityQueue())},o.prototype.ease=function(t,s){this.$el.position();var i=this.velocity(),e=(this.dt,i.x/this.scale*this.options.multiplier),o=i.y/this.scale*this.options.multiplier,n=this.handleConstraint(e,o,!0);this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash());e=0<i.x?"+="+e:"-="+Math.abs(e),o=0<i.y?"+="+o:"-="+Math.abs(o);this.options.constrainTo&&(e=!1!==n.x?n.x:e,o=!1!==n.y?n.y:o),"x"!==this.options.axis&&"x"!==this.autoAxis||(o="+=0"),"y"!==this.options.axis&&"y"!==this.autoAxis||(e="+=0");n=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;"function"==typeof this.options.moveTo?this.options.moveTo.call(this,e,o):this.moveTo(e,o,n);var a=this;this.restTimeout=setTimeout(function(){a.options.droppable&&a.calculateActiveDropRegions(),a.easing=!1,(s||!s&&-1<p.inArray("rest",a.options.callIfNotStarted))&&a.options.rest.call(a,t,a),a.options.revert&&"ease"===a.options.revertAfter&&a.options.shouldEase&&a.options.revertIf&&a.options.revertIf.call(a)&&a.revert(),a.removeActiveClass()},this.options.cssEaseDuration)},o.prototype.normalizeEvent=function(t){return t.pep={},this.isTouch(t)?(t.pep.x=t.originalEvent.touches[0].pageX,t.pep.y=t.originalEvent.touches[0].pageY,t.pep.type=t.type):!this.isPointerEventCompatible()&&this.isTouch(t)||(t.pageX?(t.pep.x=t.pageX,t.pep.y=t.pageY):(t.pep.x=t.originalEvent.pageX,t.pep.y=t.originalEvent.pageY),t.pep.type=t.type),t},o.prototype.resetVelocityQueue=function(){this.velocityQueue=new Array(5)},o.prototype.moveTo=function(t,s,i){this.log({type:"delta",x:t,y:s}),i?this.$el.animate({top:s,left:t},0,"easeOutQuad",{queue:!1}):this.$el.stop(!0,!1).css({top:s,left:t})},o.prototype.moveToUsingTransforms=function(t,s){var i=this.matrixToArray(this.matrixString());this.cssX||(this.cssX=this.xTranslation(i)),this.cssY||(this.cssY=this.yTranslation(i)),this.cssX=this.cssX+t,this.cssY=this.cssY+s,this.log({type:"delta",x:t,y:s}),i[4]=this.cssX,i[5]=this.cssY,this.translation=this.arrayToMatrix(i),this.transform(this.translation)},o.prototype.transform=function(t){this.$el.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})},o.prototype.xTranslation=function(t){return t=t||this.matrixToArray(this.matrixString()),parseInt(t[4],10)},o.prototype.yTranslation=function(t){return t=t||this.matrixToArray(this.matrixString()),parseInt(t[5],10)},o.prototype.matrixString=function(){function t(t){return!(!t||"none"===t||t.indexOf("matrix")<0)}var s="matrix(1, 0, 0, 1, 0, 0)";return t(this.$el.css("-webkit-transform"))&&(s=this.$el.css("-webkit-transform")),t(this.$el.css("-moz-transform"))&&(s=this.$el.css("-moz-transform")),t(this.$el.css("-ms-transform"))&&(s=this.$el.css("-ms-transform")),t(this.$el.css("-o-transform"))&&(s=this.$el.css("-o-transform")),t(this.$el.css("transform"))&&(s=this.$el.css("transform")),s},o.prototype.matrixToArray=function(t){return t.split("(")[1].split(")")[0].split(",")},o.prototype.arrayToMatrix=function(t){return"matrix("+t.join(",")+")"},o.prototype.addToLIFO=function(t){var s=this.velocityQueue;(s=s.slice(1,s.length)).push(t),this.velocityQueue=s},o.prototype.velocity=function(){for(var t=0,s=0,i=0;i<this.velocityQueue.length-1;i++)this.velocityQueue[i]&&(t+=this.velocityQueue[i+1].x-this.velocityQueue[i].x,s+=this.velocityQueue[i+1].y-this.velocityQueue[i].y,this.dt=this.velocityQueue[i+1].time-this.velocityQueue[i].time);return{x:t*this.options.velocityMultiplier,y:s*this.options.velocityMultiplier}},o.prototype.revert=function(){this.shouldUseCSSTranslation()&&this.moveToUsingTransforms(-this.xTranslation(),-this.yTranslation()),this.options.place&&this.moveTo(this.initialPosition.left,this.initialPosition.top)},o.prototype.requestAnimationFrame=function(t){return n.requestAnimationFrame&&n.requestAnimationFrame(t)||n.webkitRequestAnimationFrame&&n.webkitRequestAnimationFrame(t)||n.mozRequestAnimationFrame&&n.mozRequestAnimationFrame(t)||n.oRequestAnimationFrame&&n.mozRequestAnimationFrame(t)||n.msRequestAnimationFrame&&n.msRequestAnimationFrame(t)||n.setTimeout(t,1e3/60)},o.prototype.positionParent=function(){this.options.constrainTo&&!this.parentPositioned&&(this.parentPositioned=!0,"parent"===this.options.constrainTo?this.$container.css({position:"relative"}):"window"===this.options.constrainTo&&"#document"!==this.$container.get(0).nodeName&&"static"!==this.$container.css("position")&&this.$container.css({position:"static"}))},o.prototype.placeObject=function(){this.objectPlaced||(this.objectPlaced=!0,this.offset="parent"===this.options.constrainTo||this.hasNonBodyRelative()?this.$el.position():this.$el.offset(),parseInt(this.$el.css("left"),10)&&(this.offset.left=this.$el.css("left")),"number"==typeof this.options.startPos.left&&(this.offset.left=this.options.startPos.left),parseInt(this.$el.css("top"),10)&&(this.offset.top=this.$el.css("top")),"number"==typeof this.options.startPos.top&&(this.offset.top=this.options.startPos.top),this.options.removeMargins&&this.$el.css({margin:0}),this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left}))},o.prototype.hasNonBodyRelative=function(){return 1<this.$el.parents().filter(function(){var t=p(this);return t.is("body")||"relative"===t.css("position")}).length},o.prototype.setScale=function(t){this.scale=t},o.prototype.setMultiplier=function(t){this.options.multiplier=t},o.prototype.removeCSSEasing=function(){this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash(!0))},o.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})},o.prototype.removeActiveClass=function(){this.$el.removeClass([this.options.activeClass,this.options.easeClass].join(" "))},o.prototype.handleConstraint=function(t,s,i){var e=this.$el.position();this.pos.x=e.left,this.pos.y=e.top;var o,n,a,r,e={x:!1,y:!1};return this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y}),p.isArray(this.options.constrainTo)?(this.options.constrainTo[3]!==h&&this.options.constrainTo[1]!==h&&(n=!1===this.options.constrainTo[1]?1/0:this.options.constrainTo[1],a=!1===this.options.constrainTo[3]?-1/0:this.options.constrainTo[3]),!1!==this.options.constrainTo[0]&&!1!==this.options.constrainTo[2]&&(o=!1===this.options.constrainTo[2]?1/0:this.options.constrainTo[2],r=!1===this.options.constrainTo[0]?-1/0:this.options.constrainTo[0]),this.pos.x+t<a&&(e.x=a),this.pos.y+s<r&&(e.y=r)):"string"==typeof this.options.constrainTo&&(r=a=0,n=this.$container.width()-(this.options.useBoundingClientRect?this.$el[0].getBoundingClientRect().width:this.$el.outerWidth()),o=this.$container.height()-(this.options.useBoundingClientRect?this.$el[0].getBoundingClientRect().height:this.$el.outerHeight()),this.pos.x+t<0&&(e.x=0),this.pos.y+s<0&&(e.y=0)),this.pos.x+t>n&&(e.x=n),this.pos.y+s>o&&(e.y=o),this.shouldUseCSSTranslation()&&i&&(e.x===a&&this.xTranslation()&&(e.x=a-this.xTranslation()),e.x===n&&this.xTranslation()&&(e.x=n-this.xTranslation()),e.y===r&&this.yTranslation()&&(e.y=r-this.yTranslation()),e.y===o&&this.yTranslation()&&(e.y=o-this.yTranslation())),e},o.prototype.getCSSEaseHash=function(t){var s;if(void 0===t&&(t=!1),t)s="";else{if(this.CSSEaseHash)return this.CSSEaseHash;s=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}return{"-webkit-transition":s,"-moz-transition":s,"-ms-transition":s,"-o-transition":s,transition:s}},o.prototype.calculateActiveDropRegions=function(){var i=this;this.activeDropRegions.length=0,p.each(p(this.options.droppable),function(t,s){s=p(s);i.isOverlapping(s,i.$el)?(s.addClass(i.options.droppableActiveClass),i.activeDropRegions.push(s)):s.removeClass(i.options.droppableActiveClass)})},o.prototype.isOverlapping=function(t,s){if(this.options.overlapFunction)return this.options.overlapFunction(t,s);t=t[0].getBoundingClientRect(),s=s[0].getBoundingClientRect();return!(t.right<s.left||t.left>s.right||t.bottom<s.top||t.top>s.bottom)},o.prototype.isTouch=function(t){return-1<t.type.search("touch")},o.prototype.isPointerEventCompatible=function(){return"MSPointerEvent"in n},o.prototype.applyMSDefaults=function(t){this.$el.css({"-ms-touch-action":"none","touch-action":"none","-ms-scroll-chaining":"none","-ms-scroll-limit":"0 0 0 0"})},o.prototype.isValidMoveEvent=function(t){return!this.isTouch(t)||this.isTouch(t)&&t.originalEvent&&t.originalEvent.touches&&1===t.originalEvent.touches.length},o.prototype.shouldUseCSSTranslation=function(){if(this.options.forceNonCSS3Movement)return!1;if(void 0!==this.useCSSTranslation)return this.useCSSTranslation;var t=!1,t=!(!this.options.useCSSTranslation||"undefined"!=typeof Modernizr&&!Modernizr.csstransforms);return this.useCSSTranslation=t},o.prototype.cssAnimationsSupported=function(){if(void 0!==this.cssAnimationsSupport)return this.cssAnimationsSupport;if("undefined"!=typeof Modernizr&&Modernizr.cssanimations)return this.cssAnimationsSupport=!0;var t=!1,s=document.createElement("div"),i="Webkit Moz O ms Khtml".split(" "),e="";if(s.style.animationName&&(t=!0),!1===t)for(var o=0;o<i.length;o++)if(s.style[i[o]+"AnimationName"]!==h){e=i[o],e.toLowerCase(),t=!0;break}return this.cssAnimationsSupport=t},o.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},o.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}},o.prototype.buildDebugDiv=function(){var t;0===p("#pep-debug").length&&(t=p("<div></div>")).attr("id","pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"});var s=this;setTimeout(function(){s.debugElements={$event:p("#pep-debug-event"),$velocityX:p("#pep-debug-velocity .pep-x"),$velocityY:p("#pep-debug-velocity .pep-y"),$dX:p("#pep-debug-delta .pep-x"),$dY:p("#pep-debug-delta .pep-y"),$evCoordsX:p("#pep-debug-ev-coords .pep-x"),$evCoordsY:p("#pep-debug-ev-coords .pep-y"),$posCoordsX:p("#pep-debug-pos-coords .pep-x"),$posCoordsY:p("#pep-debug-pos-coords .pep-y")}},0),p("body").append(t)},o.prototype.log=function(t){if(this.options.debug)switch(t.type){case"event":this.debugElements.$event.text(t.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(t.x),this.debugElements.$posCoordsY.text(t.y);break;case"event-coords":this.debugElements.$evCoordsX.text(t.x),this.debugElements.$evCoordsY.text(t.y);break;case"delta":this.debugElements.$dX.text(t.x),this.debugElements.$dY.text(t.y);break;case"velocity":var s=this.velocity();this.debugElements.$velocityX.text(Math.round(s.x)),this.debugElements.$velocityY.text(Math.round(s.y))}},o.prototype.toggle=function(t){this.disabled=void 0===t?!this.disabled:!t},p.extend(p.easing,{easeOutQuad:function(t,s,i,e,o){return-e*(s/=o)*(s-2)+i},easeOutCirc:function(t,s,i,e,o){return e*Math.sqrt(1-(s=s/o-1)*s)+i},easeOutExpo:function(t,s,i,e,o){return s===o?i+e:e*(1-Math.pow(2,-10*s/o))+i}}),p.fn[e]=function(s){return this.each(function(){var t;p.data(this,"plugin_"+e)||(t=new o(this,s),p.data(this,"plugin_"+e,t),p.pep.peps.push(t))})},p.pep={},p.pep.peps=[],p.pep.toggleAll=function(i){p.each(this.peps,function(t,s){s.toggle(i)})},p.pep.unbind=function(t){p.each(t,function(t,s){var i=(s=p(s)).data("plugin_"+e);void 0!==i&&(i.toggle(!1),i.unsubscribe(),s.removeData("plugin_"+e))})}}(jQuery,window);